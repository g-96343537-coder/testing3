<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</title>
<style>
body {
  font-family: "ZCOOL KuaiLe', 'Microsoft YaHei', sans-serif";
  font-size: 18px; 
  background: url('https://static.vecteezy.com/system/resources/previews/033/247/266/non_2x/abstract-background-pink-blue-pastel-color-free-vector.jpg') no-repeat center center fixed;
  background-size: cover;
  padding: 20px;
  color: #000;
  overflow-x: hidden;
}

/* ä¸»æ ‡é¢˜ */
h1 {
  font-size: 2.4rem;
  text-align: center;
  margin-bottom: 20px;
}

/* é¡µç  */
#q-index {
  font-size: 1.6rem;
  margin-bottom: 15px;
}

/* æµ®ç°å±‚ï¼šè¦†ç›–é¢˜ç›®å’Œé€‰é¡¹ */
#quiz-container {
  background: rgba(255,255,255,0.85);
  padding: 24px 28px;
  border-radius: 20px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35), 0 0 20px rgba(255,255,255,0.2) inset;
  backdrop-filter: blur(6px);
  max-width: 900px;
  margin: auto;
  opacity: 80;
  animation: fadeIn 0.8s forwards, floatUpDown 3s ease-in-out infinite alternate;
}

/* æ¸æ˜¾åŠ¨ç”» */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* è½»å¾®æ¼‚æµ®åŠ¨ç”» */
@keyframes floatUpDown {
  0% { transform: translateY(0px); }
  100% { transform: translateY(-6px); }
}

/* é¢˜ç›® */
#question {
  font-size: 2rem;
  margin-bottom: 25px;
}

/* é€‰é¡¹æµ®ç°æ¡† */
.opt {
  font-size: 2.1rem;
  padding: 16px 22px;
  margin-bottom: 18px;
  border-radius: 16px;
  border: 3px solid #d0d0d0;
  background: rgba(255,255,255,0.95);
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: transform 0.15s, box-shadow 0.15s;
}
.opt:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}
.opt.correct { background: rgba(90, 220, 100,0.9); border-color: #56d56c; }
.opt.wrong { background: rgba(255, 200, 200,0.9); border-color: #ff7b7b; }

/* æŒ‰é’®æ ·å¼ */
button {
  font-size: 1.8rem;
  padding: 14px 28px;
  background: #7dbbff;
  border: none;
  border-radius: 14px;
  cursor: pointer;
  margin-top: 20px;
  transition: background 0.3s;
}
button:disabled {
    background: #ccc;
    cursor: not-allowed;
}
#finishBtn { display:none; }
#restart {
  font-size: 1.3rem;
  padding: 8px 18px;
  margin-left: 12px;
}

/* åˆ†æ•°å’Œç»“æœ */
.score {
  font-size: 1.6rem;
  margin-top: 15px;
}
#result {
  margin-top: 25px;
  font-size: 2rem;
  font-weight: bold;
  text-align: center;
  color: #1a1a1a;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
}
#upload-status {
    font-size: 1rem;
    color: #666;
    text-align: center;
    margin-top: 10px;
}

/* å­¦ç”Ÿä¿¡æ¯é¡µ */
#student-info {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
#student-info input, #student-info select {
  font-size: 1.8rem;
  padding: 10px 14px;
  border-radius: 12px;
  border: 2px solid #d0d0d0;
}
#student-info button {
  width: 180px;
  align-self: center;
}
</style>
</head>
<body>
<h1>äºŒå¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</h1>

<div id="quiz-container">
  <div id="student-info">
    <label>å§“åï¼š
      <input type="text" id="studentName" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">
    </label>
    <label>ç­çº§ï¼š
      <select id="studentClass">
        <option value="">è¯·é€‰æ‹©ç­çº§</option>
        <option value="2M">2M</option>
        <option value="2K">2K</option>
        <option value="2B">2B</option>
        <option value="2H">2H</option>
        <option value="2J">2J</option>
      </select>
    </label>
    <button id="startQuiz">å¼€å§‹æµ‹éªŒ</button>
  </div>

  <div id="quiz-content" style="display:none;">
    <div id="q-index">ç¬¬ <span id="cur">1</span> / <span id="total">0</span> é¢˜</div>
    <div id="question"></div>
    <div id="options"></div>
    <div class="controls">
      <div class="score" id="score">å¾—åˆ†ï¼š0</div>
      <button id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
      <button id="finishBtn">å®Œæˆæµ‹éªŒ</button>
      <button id="restart">é‡åš</button>
    </div>
    <div id="result"></div>
    <div id="upload-status"></div>
  </div>
</div>

<script>
// ====== Google Apps Script URL ======
// è¯·ç¡®ä¿æ­¤é“¾æ¥å·²éƒ¨ç½²ä¸º Web Appï¼Œä¸”æƒé™è®¾ç½®ä¸º "Anyone" (ä»»ä½•äºº)
const scriptURL = "https://script.google.com/macros/s/AKfycby2h2i4vVaR59Q4vJJCxqm5asE61UV6yWzMuGyHX3h7m5towFqmJs5YZdvnohSMzKE/exec";

// ====== é¢˜åº“ ======
const rawData = `
1,æ•°å­— 605 è¯»ä½œä»€ä¹ˆï¼Ÿ A. å…­ç™¾äº”å B. å…­ç™¾é›¶äº” C. å…­ç™¾äº”é›¶ D. å…­åäº”,B
2,é€‰å‡º â€œå…«ç™¾ä¸€åäºŒâ€ çš„æ•°å­—å†™æ³•ã€‚ A. 812 B. 821 C. 802 D. 820,A
3,åœ¨æ•°ç›® 492 ä¸­ï¼Œæ•°å­— 9 çš„æ•°ä½æ˜¯ä»€ä¹ˆï¼Ÿ A. ä¸ªä½ B. åä½ C. ç™¾ä½ D. åƒä½,B
4,åœ¨æ•°ç›® 735 ä¸­ï¼Œæ•°å­— 7 çš„æ•°å€¼æ˜¯å¤šå°‘ï¼Ÿ A. 7 B. 70 C. 700 D. 7000,C
5,å“ªä¸ªæ•°ç›®çš„åä½æ˜¯ 0ï¼Ÿ A. 310 B. 508 C. 420 D. 600,A
6,é€‰å‡ºæ¯” 550 å¤§ï¼Œä½†æ¯” 600 å°çš„æ•°ç›®ã€‚ A. 549 B. 589 C. 601 D. 650,B
7,å“ªä¸ªæ•°åˆ—æ˜¯é¡ºåºæ’åˆ—çš„ï¼Ÿ A. 210, 215, 220, 225 B. 300, 290, 280, 270 C. 105, 100, 110, 115 D. 450, 440, 460, 470,A
8,å®Œæˆæ•°åˆ—ï¼š100, 200, ( ), 400, 500ã€‚ A. 250 B. 300 C. 350 D. 600,B
9,426 çš„åä½è¿‘ä¼¼å€¼æ˜¯å¤šå°‘ï¼Ÿ A. 420 B. 430 C. 400 D. 500,A
10,875 çš„ç™¾ä½è¿‘ä¼¼å€¼æ˜¯å¤šå°‘ï¼Ÿ A. 800 B. 870 C. 880 D. 900,A
11,324 + 45 = A. 360 B. 369 C. 379 D. 469,B
12,208 + 560 = A. 708 B. 760 C. 768 D. 868,C
13,å“ªé¡¹ç®—å¼çš„ç­”æ¡ˆæœ€å¤§ï¼Ÿ A. 100 + 200 B. 150 + 100 C. 300 + 50 D. 200 + 250,D
14,458 - 32 = A. 420 B. 426 C. 436 D. 480,C
15,600 - 255 = A. 345 B. 355 C. 445 D. 455,A
16,980 - 120 - 50 = A. 800 B. 810 C. 860 D. 910,B
17,( ) - 150 = 300ã€‚æ‹¬å·é‡Œåº”å¡«å…¥ä»€ä¹ˆæ•°ç›®ï¼Ÿ A. 150 B. 250 C. 450 D. 500,C
18,è®¡ç®— 125 + 75 - 50 çš„ç­”æ¡ˆã€‚ A. 100 B. 150 C. 200 D. 250,C
19,6 X 4 = A. 10 B. 20 C. 24 D. 30,C
20,å“ªä¸ªç®—å¼ä»£è¡¨ â€œ5 ä¸ª 3â€ï¼Ÿ A. 5 + 3 B. 3 X 5 C. 5 - 3 D. 5 Ã·3,B
21,9 X 0 çš„ç­”æ¡ˆæ˜¯ï¼š A. 0 B. 1 C. 9 D. 90,A
22,7 X 10 = A. 7 B. 17 C. 70 D. 700,C
23,20 Ã· 5 A. 3 B. 4 C. 5 D. 6,B
24,48 Ã· 8 = A. 5 B. 6 C. 7 D. 8,B
25,ä»»ä½•æ•°ç›®é™¤ä»¥ 1ï¼Œç­”æ¡ˆæ˜¯ï¼š A. 0 B. 1 C. åŸåŸæœ¬æœ¬çš„æ•°ç›® D. 10,C
26,å¦ˆå¦ˆä¹°äº† 8 ä¸ªè‹¹æœï¼Œå¹³åˆ†ç»™ 2 ä¸ªå­©å­ï¼Œæ¯ä¸ªå­©å­å¾—å‡ ä¸ªï¼Ÿ A. 2 B. 4 C. 6 D. 16,B
27,åœè½¦åœºé‡Œæœ‰ 120 è¾†çº¢è½¦å’Œ 85 è¾†è“è½¦ã€‚åœè½¦åœºé‡Œä¸€å…±æœ‰å¤šå°‘è¾†è½¦ï¼Ÿ A. 195 B. 200 C. 205 D. 215,C
28,å”å”å…»äº† 350 åªé¸¡ï¼Œå–æ‰äº† 120 åªã€‚ä»–è¿˜å‰©ä¸‹å¤šå°‘åªé¸¡ï¼Ÿ A. 200 B. 230 C. 470 D. 500,B
29,ä¸€åªçŒ«æœ‰ 4 æ¡è…¿ã€‚5 åªçŒ«ä¸€å…±æœ‰å¤šå°‘æ¡è…¿ï¼Ÿ A. 9 B. 15 C. 20 D. 25,C
30,è€å¸ˆæœ‰ 40 é¢—ç³–æœï¼Œæ¯ä½å­¦ç”Ÿåˆ† 10 é¢—ï¼Œå¯ä»¥åˆ†ç»™å‡ ä½å­¦ç”Ÿï¼Ÿ A. 3 B. 4 C. 10 D. 50,B
`;

// ====== è§£æ CSV ======
const data = rawData.trim().split("\n").map(line=>{
  const parts = line.split(",");
  const answer = parts.pop().trim().toUpperCase();
  const qid = parts.shift();
  const full = parts.join(",").trim();
  const optStart = full.indexOf("A.");
  const qtext = full.slice(0, optStart).trim();
  const optRaw = full.slice(optStart);
  const optParts = optRaw.split(/\s(?=[A-D]\.\s)/).map(s=>s.trim());
  const opts = optParts.map(op => op.replace(/^[A-D]\.\s*/, ""));
  while (opts.length < 4) opts.push("(ç¼ºå¤±)");
  return { q: qtext, options: opts, answer: {A:0,B:1,C:2,D:3}[answer] };
});

// ====== æµ‹éªŒé€»è¾‘ ======
let current=0, score=0, answered=false;
document.getElementById('total').textContent = data.length;

function loadQuestion(){
  answered=false;
  document.getElementById('nextBtn').disabled = true;
  document.getElementById('finishBtn').style.display = 'none';
  document.getElementById('result').textContent = '';
  document.getElementById('upload-status').textContent = '';
  const q = data[current];
  document.getElementById('question').textContent = q.q;
  document.getElementById('cur').textContent = current+1;

  const optsDiv = document.getElementById('options');
  optsDiv.innerHTML = '';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='opt';
    div.textContent = opt;
    div.addEventListener('click',()=>selectOption(div,i));
    optsDiv.appendChild(div);
  });
}

function selectOption(el,index){
  if(answered) return;
  answered=true;
  const q = data[current];
  const all = document.querySelectorAll('.opt');
  all.forEach((d,i)=>{ if(i===q.answer) d.classList.add('correct'); });
  if(index!==q.answer) el.classList.add('wrong');
  else score++;
  document.getElementById('score').textContent='å¾—åˆ†ï¼š'+score;

  if(current === data.length-1){
    document.getElementById('finishBtn').style.display='inline-block';
    document.getElementById('nextBtn').style.display='none';
  } else {
    document.getElementById('nextBtn').disabled=false;
  }
}

// ä¸‹ä¸€é¢˜
document.getElementById('nextBtn').addEventListener('click',()=>{
  current++;
  loadQuestion();
});

// ====== å…³é”®ä¿®æ”¹ï¼šå®Œæˆæµ‹éªŒå¹¶å‘é€æ•°æ® ======
document.getElementById('finishBtn').addEventListener('click', () => {
  const finishBtn = document.getElementById('finishBtn');
  const resultDiv = document.getElementById('result');
  const statusDiv = document.getElementById('upload-status');
  
  // 1. ç•Œé¢åé¦ˆï¼šç¦ç”¨æŒ‰é’®ï¼Œæç¤ºæ­£åœ¨ä¸Šä¼ 
  finishBtn.disabled = true;
  finishBtn.textContent = 'æ­£åœ¨ä¿å­˜æˆç»©...';
  
  // 2. å‡†å¤‡æ•°æ®
  const payload = {
    name: studentName,
    class: studentClass,
    score: score,
    total: data.length
  };
  
  // 3. å‘é€åˆ° Google Apps Script
  // æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»ä½¿ç”¨ JSON.stringifyï¼Œå› ä¸ºä½ çš„åç«¯æ˜¯ç”¨ JSON.parse(e.postData.contents) æ¥æ”¶çš„
  fetch(scriptURL, {
    method: 'POST',
    body: JSON.stringify(payload),
    // é‡è¦ï¼šä¸è¦è®¾ç½® header ä¸º application/jsonï¼Œå¦åˆ™ä¼šè§¦å‘ CORS é¢„æ£€å¤±è´¥
    // é»˜è®¤ä½œä¸º text/plain å‘é€ï¼Œä½ çš„åç«¯ä»£ç ä¹Ÿèƒ½å®Œç¾å¤„ç†
  })
  .then(response => {
    if (response.ok) {
      return response.text();
    }
    throw new Error('ç½‘ç»œå“åº”é”™è¯¯');
  })
  .then(data => {
    // æˆåŠŸ
    console.log('æˆåŠŸ:', data);
    resultDiv.textContent = `ğŸ‰ å¤ªæ£’å•¦ï¼Œ${studentName}! æ€»å¾—åˆ†ï¼š${score} / ${data.length}`;
    statusDiv.textContent = "âœ… æˆç»©å·²æˆåŠŸä¸Šä¼ ç»™è€å¸ˆï¼";
    finishBtn.style.display = 'none'; // éšè—æŒ‰é’®
  })
  .catch((error) => {
    // å¤±è´¥
    console.error('é”™è¯¯:', error);
    resultDiv.textContent = `ğŸ‰ å®Œæˆï¼${studentName}, æ€»å¾—åˆ†ï¼š${score} / ${data.length}`;
    statusDiv.innerHTML = `<span style="color:red">âš ï¸ æˆç»©ä¸Šä¼ å¤±è´¥ï¼Œè¯·æŠŠè¿™ä¸ªç”»é¢æˆªå›¾å‘ç»™è€å¸ˆã€‚<br>åŸå› : ${error.message}</span>`;
    finishBtn.textContent = 'å®Œæˆæµ‹éªŒ'; // æ¢å¤æŒ‰é’®æ–‡å­—
    finishBtn.disabled = false; // å…è®¸é‡è¯•
  });
});

// é‡åš
document.getElementById('restart').addEventListener('click',()=>{
  if(confirm('ç¡®å®šé‡åšæµ‹éªŒå—ï¼Ÿæˆç»©å°†é‡æ–°è®¡ç®—ã€‚')){
    current=0;
    score=0;
    document.getElementById('score').textContent='å¾—åˆ†ï¼š0';
    document.getElementById('nextBtn').style.display='inline-block';
    document.getElementById('nextBtn').disabled=true;
    document.getElementById('upload-status').textContent = ''; // æ¸…ç©ºçŠ¶æ€
    loadQuestion();
  }
});

// ====== å­¦ç”Ÿä¿¡æ¯é¡µé€»è¾‘ ======
let studentName = '';
let studentClass = '';
document.getElementById('startQuiz').addEventListener('click',()=>{
  const nameInput = document.getElementById('studentName').value.trim();
  const classSelect = document.getElementById('studentClass').value;
  if(!nameInput || !classSelect){
    alert('è¯·å¡«å†™å§“åå¹¶é€‰æ‹©ç­çº§ï¼');
    return;
  }
  studentName = nameInput;
  studentClass = classSelect;

  // éšè—ä¿¡æ¯é¡µï¼Œæ˜¾ç¤ºæµ‹éªŒé¡µ
  document.getElementById('student-info').style.display='none';
  document.getElementById('quiz-content').style.display='block';
  loadQuestion();
});
</script>
</body>
</html>
