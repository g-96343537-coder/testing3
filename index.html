<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { padding: 20px; background-color: #f8f9fa; }
      .container { max-width: 600px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
      #result-card { display: none; margin-top: 20px; }
      .loading { display: none; text-align: center; margin-top: 10px;}
    </style>
  </head>
  <body>
    
    <div class="container">
      <h2 class="text-center mb-4">学生成绩查询</h2>
      
      <div class="mb-3">
        <label for="studentId" class="form-label">请输入学号：</label>
        <input type="text" class="form-control" id="studentId" placeholder="例如：1001">
      </div>
      
      <button class="btn btn-primary w-100" onclick="handleSearch()">查询</button>
      
      <div id="loading" class="loading">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p>正在查询数据...</p>
      </div>

      <div id="result-card" class="card">
        <div class="card-header bg-success text-white">查询结果</div>
        <div class="card-body">
          <h5 class="card-title">姓名：<span id="resName"></span></h5>
          <hr>
          <p class="card-text">数学：<span id="resMath" class="fw-bold"></span></p>
          <p class="card-text">英文：<span id="resEng" class="fw-bold"></span></p>
        </div>
      </div>
      
    </div>

    <script>
      function handleSearch() {
        var id = document.getElementById('studentId').value;
        if(!id) {
          alert("请输入学号！");
          return;
        }

        // 显示加载，隐藏旧结果
        document.getElementById('loading').style.display = 'block';
        document.getElementById('result-card').style.display = 'none';

        // 调用后端 Google Apps Script 函数
        google.script.run
          .withSuccessHandler(showResult)
          .searchScore(id);
      }

      function showResult(response) {
        // 隐藏加载动画
        document.getElementById('loading').style.display = 'none';

        if (response.status === 'success') {
          document.getElementById('resName').innerText = response.name;
          document.getElementById('resMath').innerText = response.math;
          document.getElementById('resEng').innerText = response.english;
          document.getElementById('result-card').style.display = 'block';
        } else {
          alert(response.message);
        }
      }
    </script>
  </body>
</html>
