<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ä¸‰å¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</title>
<style>
body {
  font-family: "ZCOOL KuaiLe', 'Microsoft YaHei', sans-serif";
  font-size: 18px; 
  background: url('https://www.freevector.com/uploads/vector/preview/31147/Freevector_Colorful-Abstract-Background_mf0221.jpg') no-repeat center center fixed;
  background-size: cover;
  padding: 20px;
  color: #000;
  overflow-x: hidden;
}

h1 {
  font-size: 2.4rem;
  text-align: center;
  margin-bottom: 20px;
}

#q-index {
  font-size: 1.6rem;
  margin-bottom: 15px;
}

#quiz-container {
  background: rgba(255,255,255,0.85);
  padding: 24px 28px;
  border-radius: 20px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.35), 0 0 20px rgba(255,255,255,0.2) inset;
  backdrop-filter: blur(6px);
  max-width: 900px;
  margin: auto;
  opacity: 80;
  animation: fadeIn 0.8s forwards, floatUpDown 3s ease-in-out infinite alternate;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes floatUpDown {
  0% { transform: translateY(0px); }
  100% { transform: translateY(-6px); }
}

#question {
  font-size: 2rem;
  margin-bottom: 25px;
}

.opt {
  font-size: 2.1rem;
  padding: 16px 22px;
  margin-bottom: 18px;
  border-radius: 16px;
  border: 3px solid #d0d0d0;
  background: rgba(255,255,255,0.95);
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  transition: transform 0.15s, box-shadow 0.15s;
}
.opt:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.3);
}
.opt.correct { background: rgba(90, 220, 100,0.9); border-color: #56d56c; }
.opt.wrong { background: rgba(255, 200, 200,0.9); border-color: #ff7b7b; }

button {
  font-size: 1.8rem;
  padding: 14px 28px;
  background: #7dbbff;
  border: none;
  border-radius: 14px;
  cursor: pointer;
  margin-top: 20px;
  transition: background 0.3s;
}
button:disabled {
    background: #ccc;
    cursor: not-allowed;
}
#finishBtn { display:none; }
#restart {
  font-size: 1.3rem;
  padding: 8px 18px;
  margin-left: 12px;
}

.score {
  font-size: 1.6rem;
  margin-top: 15px;
}
#result {
  margin-top: 25px;
  font-size: 2rem;
  font-weight: bold;
  text-align: center;
  color: #1a1a1a;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
}
#upload-status {
    font-size: 1.2rem;
    color: #444;
    text-align: center;
    margin-top: 15px;
    min-height: 30px;
}

#student-info {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
#student-info input, #student-info select {
  font-size: 1.8rem;
  padding: 10px 14px;
  border-radius: 12px;
  border: 2px solid #d0d0d0;
}
#student-info button {
  width: 180px;
  align-self: center;
}
</style>
</head>
<body>
<h1>ä¸‰å¹´çº§æ•°å­¦é€‰æ‹©é¢˜æµ‹éªŒ</h1>

<div id="quiz-container">
  <div id="student-info">
    <label>å§“åï¼š
      <input type="text" id="studentName" placeholder="è¯·è¾“å…¥ä½ çš„åå­—">
    </label>
    <label>ç­çº§ï¼š
      <select id="studentClass">
        <option value="">è¯·é€‰æ‹©ç­çº§</option>
        <option value="3M">3M</option>
        <option value="3K">3K</option>
        <option value="3B">3B</option>
        <option value="3H">3H</option>
        <option value="3J">3J</option>
      </select>
    </label>
    <button id="startQuiz">å¼€å§‹æµ‹éªŒ</button>
  </div>

  <div id="quiz-content" style="display:none;">
    <div id="q-index">ç¬¬ <span id="cur">1</span> / <span id="total">0</span> é¢˜</div>
    <div id="question"></div>
    <div id="options"></div>
    <div class="controls">
      <div class="score" id="score">å¾—åˆ†ï¼š0</div>
      <button id="nextBtn" disabled>ä¸‹ä¸€é¢˜</button>
      <button id="finishBtn">å®Œæˆæµ‹éªŒ</button>
      <button id="restart">é‡åš</button>
    </div>
    <div id="result"></div>
    <div id="upload-status"></div>
  </div>
</div>

<script>
// ====== Google Apps Script URL ======
// è¯·ç¡®ä¿æ­¤é“¾æ¥å·²éƒ¨ç½²ä¸º Web Appï¼Œä¸”æƒé™è®¾ç½®ä¸º "Anyone" (ä»»ä½•äºº)
const scriptURL = "https://script.google.com/macros/s/AKfycbzuA7A_loQmM8AfheooizJWB3E18ot4Yvcqc_yNUfk-YtFH4l7xGHa8RfgpjuCB9v1L-Q/exec";

// ====== é¢˜åº“ ======
const rawData = `
1,è¿™é‡Œçš„æ•°ç›®æ˜¯ â€œå››åƒé›¶äº”â€ã€‚è¯·é—®æ•°å­—å†™æ³•æ˜¯ï¼š A. 405 B. 4005 C. 4050 D. 4500,B
2,åœ¨æ•°ç›® 3 582 ä¸­ï¼Œæ•°å­— 5 çš„æ•°ä½ (Place Value) æ˜¯ä»€ä¹ˆï¼Ÿ A. ä¸ªä½ B. åä½ C. ç™¾ä½ D. åƒä½,C
3,å“ªä¸ªæ•°ç›®çš„ç™¾ä½è¿‘ä¼¼å€¼æ˜¯ 2 000ï¼Ÿ A. 1 920 B. 1 955 C. 2 055 D. 2 100,B
4,2 145 + 3 620 = A. 5 765 B. 5 785 C. 5 865 D. 6 765,A
5,8 000 - 3 456 = A. 4 544 B. 4 644 C. 5 456 D. 5 544,A
6,245 x 4 = A. 860 B. 880 C. 960 D. 980,D
7,72 / 8 = A. 7 B. 8 C. 9 D. 10,C
8,560 / 10 = A. 56 B. 50 C. 6 D. 5,A
9,å“ªé¡¹åˆ†æ•°çš„æ•°å€¼æœ€å°ï¼Ÿ A. 1/2 B. 1/4 C. 1/8 D. 1/10,D
10,3/7 + 2/7 = A. 5/14 B. 5/7 C. 6/7 D. 1/7,B
11,7/9 - 4/9 = A. 2/9 B. 3/9 (æˆ– 1/3) C. 3/0 D. 11/9,B
12,0.5 + 0.3 = A. 0.2 B. 0.8 C. 0.53 D. 8.0,B
13,æŠŠ 35% å†™æˆå°æ•°ã€‚ A. 0.35 B. 3.5 C. 35.0 D. 0.035,A
14,å›¾ä¸­æ¶‚é»‘éƒ¨åˆ†å å…¨å›¾çš„ 45/100ã€‚è¯·é—®ç™¾åˆ†æ¯”æ˜¯å¤šå°‘ï¼Ÿ A. 4% B. 5% C. 45% D. 55%,C
15,RM 50.00 - RM 13.50 = A. RM 36.50 B. RM 37.50 C. RM 43.50 D. RM 47.50,A
16,RM 125 x 3 = A. RM 325 B. RM 350 C. RM 375 D. RM 475,C
17,3 å¼  RM 50 å’Œ 2 å¼  RM 20 å…±æœ‰å¤šå°‘é’±ï¼Ÿ A. RM 70 B. RM 170 C. RM 190 D. RM 210,C
18,ç°åœ¨æ˜¯ 3:00 p.m.ã€‚30 åˆ†é’Ÿåçš„æ—¶åˆ»æ˜¯ï¼š A. 3:30 p.m. B. 4:00 p.m. C. 4:30 p.m. D. 2:30 p.m.,A
19,1 å°æ—¶ç­‰äºå¤šå°‘åˆ†é’Ÿï¼Ÿ A. 10 B. 24 C. 60 D. 100,C
20,3 åˆ†é’Ÿç­‰äºå¤šå°‘ç§’ï¼Ÿ A. 120 ç§’ B. 160 ç§’ C. 180 ç§’ D. 300 ç§’,C
21,ä¸€å¹´æœ‰å¤šå°‘ä¸ªæœˆï¼Ÿ A. 10 B. 12 C. 24 D. 365,B
22,2 m 45 cm ç­‰äºå¤šå°‘ cmï¼Ÿ A. 245 cm B. 2045 cm C. 2450 cm D. 20045 cm,A
23,1 kg ç­‰äºå¤šå°‘ gï¼Ÿ A. 10 g B. 100 g C. 500 g D. 1 000 g,D
24,3 kg 500 g + 2 kg 200 g = A. 5 kg 300 g B. 5 kg 700 g C. 6 kg 700 g D. 1 kg 300 g,B
25,1 å‡ (L) ç­‰äºå¤šå°‘æ¯«å‡ (ml)ï¼Ÿ A. 10 ml B. 100 ml C. 1 000 ml D. 10 000 ml,C
26,500 ml + 850 ml = A. 1 L 350 ml B. 1 L 500 ml C. 135 ml D. 1350 L,A
27,æ­£æ–¹ä½“ (Cube) æœ‰å‡ ä¸ªå¹³é¢ï¼Ÿ A. 4 B. 6 C. 8 D. 12,B
28,ä¸‹åˆ—å“ªç§ç«‹ä½“å›¾å½¢æœ‰æ›²é¢ï¼Ÿ A. æ­£æ–¹ä½“ B. é•¿æ–¹ä½“ C. åœ†æŸ±ä½“ D. æ­£æ£±é”¥ä½“,C
29,åœ¨è±¡å½¢ç»Ÿè®¡å›¾ä¸­ï¼Œä¸€ä¸ªç¬‘è„¸ç¬¦å·ä»£è¡¨ 5 ä¸ªäººã€‚å¦‚æœæœ‰ 4 ä¸ªç¬‘è„¸ç¬¦å·ï¼Œä»£è¡¨å¤šå°‘äººï¼Ÿ A. 4 B. 9 C. 20 D. 45,C
30,å¦‚æœé¥¼åˆ†å›¾è¢«åˆ†æˆ 4 ä¸ªç›¸ç­‰çš„éƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†ä»£è¡¨å¤šå°‘ç™¾åˆ†æ¯”ï¼Ÿ A. 10% B. 25% C. 50% D. 100%,B
`;

// ====== è§£æ CSV ======
const data = rawData.trim().split("\n").map(line=>{
  const parts = line.split(",");
  const answer = parts.pop().trim().toUpperCase();
  const qid = parts.shift();
  const full = parts.join(",").trim();
  const optStart = full.indexOf("A.");
  const qtext = full.slice(0, optStart).trim();
  const optRaw = full.slice(optStart);
  const optParts = optRaw.split(/\s(?=[A-D]\.\s)/).map(s=>s.trim());
  const opts = optParts.map(op => op.replace(/^[A-D]\.\s*/, ""));
  while (opts.length < 4) opts.push("(ç¼ºå¤±)");
  return { q: qtext, options: opts, answer: {A:0,B:1,C:2,D:3}[answer] };
});

// ====== æµ‹éªŒé€»è¾‘ ======
let current=0, score=0, answered=false;
document.getElementById('total').textContent = data.length;

function loadQuestion(){
  answered=false;
  document.getElementById('nextBtn').disabled = true;
  document.getElementById('finishBtn').style.display = 'none';
  document.getElementById('result').textContent = '';
  document.getElementById('upload-status').textContent = '';
  const q = data[current];
  document.getElementById('question').textContent = q.q;
  document.getElementById('cur').textContent = current+1;

  const optsDiv = document.getElementById('options');
  optsDiv.innerHTML = '';
  q.options.forEach((opt,i)=>{
    const div = document.createElement('div');
    div.className='opt';
    div.textContent = opt;
    div.addEventListener('click',()=>selectOption(div,i));
    optsDiv.appendChild(div);
  });
}

function selectOption(el,index){
  if(answered) return;
  answered=true;
  const q = data[current];
  const all = document.querySelectorAll('.opt');
  all.forEach((d,i)=>{ if(i===q.answer) d.classList.add('correct'); });
  if(index!==q.answer) el.classList.add('wrong');
  else score++;
  document.getElementById('score').textContent='å¾—åˆ†ï¼š'+score;

  if(current === data.length-1){
    document.getElementById('finishBtn').style.display='inline-block';
    document.getElementById('nextBtn').style.display='none';
  } else {
    document.getElementById('nextBtn').disabled=false;
  }
}

// ä¸‹ä¸€é¢˜
document.getElementById('nextBtn').addEventListener('click',()=>{
  current++;
  loadQuestion();
});

// ====== å…³é”®ä¿®æ”¹ï¼šno-cors æ¨¡å¼ ======
document.getElementById('finishBtn').addEventListener('click', () => {
  const finishBtn = document.getElementById('finishBtn');
  const resultDiv = document.getElementById('result');
  const statusDiv = document.getElementById('upload-status');
  
  // 1. ç•Œé¢åé¦ˆ
  finishBtn.disabled = true;
  finishBtn.textContent = 'æ­£åœ¨ä¿å­˜æˆç»©...';
  
  // 2. å‡†å¤‡æ•°æ® (ä½¿ç”¨ URLSearchParams)
  const formData = new URLSearchParams();
  formData.append('name', studentName);
  formData.append('class', studentClass);
  formData.append('score', score);
  formData.append('total', data.length);
  
  // 3. å‘é€ (å¼€å¯ no-cors æ¨¡å¼)
  fetch(scriptURL, {
    method: 'POST',
    // âš ï¸ é‡ç‚¹ï¼šno-cors æ¨¡å¼ã€‚å‘Šè¯‰æµè§ˆå™¨å¿½ç•¥è·¨åŸŸæ£€æŸ¥ã€‚
    // å‰¯ä½œç”¨ï¼šæˆ‘ä»¬æ— æ³•è¯»å–æœåŠ¡å™¨çš„è¿”å›å†…å®¹ï¼ˆopaque responseï¼‰ã€‚
    // ä½†åªè¦è¯·æ±‚å‘å‡ºå»äº†ï¼ŒGoogle Script å°±ä¼šæ‰§è¡Œã€‚
    mode: 'no-cors', 
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: formData
  })
  .then(() => {
    // å› ä¸ºæ˜¯ no-corsï¼Œæˆ‘ä»¬å‡è®¾æ²¡æœ‰ç½‘ç»œæŠ¥é”™å°±æ˜¯æˆåŠŸäº†
    // è™½ç„¶çœ‹ä¸åˆ°æœåŠ¡å™¨è¿”å›çš„ "success" å­—æ ·ï¼Œä½†æ•°æ®åº”è¯¥å·²ç»åˆ°äº†
    console.log('Request sent (no-cors mode)');
    resultDiv.textContent = `ğŸ‰ å¤ªæ£’å•¦ï¼Œ${studentName}! æ€»å¾—åˆ†ï¼š${score} / ${data.length}`;
    statusDiv.textContent = "âœ… æˆç»©å·²å‘é€ç»™è€å¸ˆï¼";
    finishBtn.style.display = 'none'; 
  })
  .catch((error) => {
    // åªæœ‰æ–­ç½‘æˆ–åœ°å€ä¸¥é‡é”™è¯¯æ‰ä¼šè¿›è¿™é‡Œ
    console.error('Fetch error:', error);
    resultDiv.textContent = `ğŸ‰ å®Œæˆï¼${studentName}, æ€»å¾—åˆ†ï¼š${score} / ${data.length}`;
    statusDiv.innerHTML = `<span style="color:red">âš ï¸ æˆç»©ä¸Šä¼ å¤±è´¥ã€‚<br>åŸå› : ${error.message}</span>`;
    finishBtn.textContent = 'é‡è¯•ä¸Šä¼ ';
    finishBtn.disabled = false;
  });
});

// é‡åš
document.getElementById('restart').addEventListener('click',()=>{
  if(confirm('ç¡®å®šé‡åšæµ‹éªŒå—ï¼Ÿæˆç»©å°†é‡æ–°è®¡ç®—ã€‚')){
    current=0;
    score=0;
    document.getElementById('score').textContent='å¾—åˆ†ï¼š0';
    document.getElementById('nextBtn').style.display='inline-block';
    document.getElementById('nextBtn').disabled=true;
    document.getElementById('upload-status').textContent = ''; 
    loadQuestion();
  }
});

// ====== å­¦ç”Ÿä¿¡æ¯é¡µé€»è¾‘ ======
let studentName = '';
let studentClass = '';
document.getElementById('startQuiz').addEventListener('click',()=>{
  const nameInput = document.getElementById('studentName').value.trim();
  const classSelect = document.getElementById('studentClass').value;
  if(!nameInput || !classSelect){
    alert('è¯·å¡«å†™å§“åå¹¶é€‰æ‹©ç­çº§ï¼');
    return;
  }
  studentName = nameInput;
  studentClass = classSelect;

  document.getElementById('student-info').style.display='none';
  document.getElementById('quiz-content').style.display='block';
  loadQuestion();
});
</script>
</body>
</html>
